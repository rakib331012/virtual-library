
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Virtual Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a1a2e;        /* Dark blue for headers and footers */
            --secondary: #ffd700;      /* Gold accent for buttons and highlights */
            --background: #f0f2f5;     /* Light gray background */
            --card-bg: #f8f5e9;        /* White for cards and panels */
            --text: #1a1a2e;           /* Dark text */
            --text-light: #6b7280;     /* Gray for secondary text */
            --border: #e5e7eb;         /* Light border color */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f0f2f5 url('https://img.freepik.com/free-photo/blue-smooth-wall-textured-background_53876-106133.jpg?semt=ais_hybrid&w=740') repeat;
            color: var(--text);
            line-height: 1.6;
        }

        .library-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            padding: 20px 0;
            background: var(--primary);
            color: white;
            text-align: center;
            position: relative;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(to right, var(--primary), #2c3e50);
            color: white;
            padding: 50px 0;
            text-align: center;
            margin-bottom: 40px;
        }

        .hero h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .hero p {
            font-size: 1.2rem;
        }

        /* User Panel */
        .user-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0dcdc;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .user-panel.active {
            display: block;
        }

        .user-panel button {
            display: block;
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: none;
            background: var(--secondary);
            color: var(--primary);
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .user-panel button:hover {
            background: #e6c200;
        }

        .panel-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--secondary);
            color: var(--primary);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Controls */
        .controls {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e0dcdc; /* Add a subtle border for definition */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .search-bar {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid var(--border);
            border-radius: 25px;
            font-size: 1rem;
            background: var(--card-bg);
            background: #ffffff;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .filter-options {
            display: flex;
            flex-direction: column; /* Already set to stack vertically */
            gap: 15px;
            margin-top: 20px;
            align-items: center; /* Center all children horizontally */
        }

        select {
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 25px;
            background: var(--card-bg);
            background: #ffffff;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        select:hover {
            border-color: var(--secondary);
        }

        /* Genre Filter */
        .genre-filter {
            margin-top: 0;
        }

        .genre-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .genre-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .genre-btn {
            padding: 10px 20px;
            border: 1px solid var(--border);
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            background: var(--card-bg);
            transition: all 0.3s ease;
        }

        .genre-btn:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .genre-btn.active {
            background: var(--secondary);
            color: var(--primary);
            border-color: var(--secondary);
        }

        /* Tabs */
        .tab-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .tab-button {
            padding: 12px 25px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: var(--secondary);
            color: var(--primary);
            border-color: var(--secondary);
        }

        /* Book List */
        .book-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .book-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #e0dcdc; /* Add a subtle border for definition */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            background: #fefef0;
        }

        .book-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .book-author {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .book-status {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            display: inline-block;
        }

        .available { background: #10b981; color: white; }
        .checked-out { background: #ef4444; color: white; }

        .toggle-status {
            margin-top: 10px;
            padding: 5px 10px;
            background: var(--secondary);
            color: var(--primary);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--card-bg);
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #e0dcdc; /* Add a subtle border for definition */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            animation: slideIn 0.3s ease-out;
            position: relative;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-light);
        }

        /* Form Styles */
        .modal-content form label {
            display: block;
            margin-bottom: 10px;
        }

        .modal-content form input,
        .modal-content form select,
        .modal-content form textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 5px;
        }

        .modal-content form button {
            padding: 10px 20px;
            margin-right: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .modal-content form button[type="submit"] {
            background: var(--secondary);
            color: var(--primary);
        }

        .modal-content form button[type="button"] {
            background: var(--text-light);
            color: white;
        }

        /* Request item */
        .request-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .request-item button {
            background: var(--secondary);
            color: var(--primary);
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* About Section */
        .about {
            background: var(--primary);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 40px;
            text-align: center;
        }

        .about h2 {
            font-weight: 700;
        }

        /* Footer */
        footer {
            background: var(--primary);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 15px 15px 0 0;
        }

        footer a {
            color: var(--secondary);
            text-decoration: none;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .filter-options { flex-direction: column; }
            .tab-buttons { flex-wrap: wrap; }
            .book-list { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
        }

        @media (max-width: 480px) {
            header h1 { font-size: 2rem; }
            .controls { padding: 15px; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Virtual Library</h1>
        <button class="panel-toggle" id="panelToggle">Menu</button>
        <div class="user-panel" id="userPanel">
            <button id="loginBtn">Login</button>
            <button id="logoutBtn">Logout</button>
            <button id="issueBook" class="user-only">Issue Book</button>
            <button id="toggleAdmin">Toggle Admin Mode</button>
            <button id="addBook" class="admin-only">Add Book</button>
            <button id="viewRequests" class="admin-only">Issue Requests</button>
        </div>
    </header>

    <div class="hero">
        <h2>Welcome to Our Library</h2>
        <p>Explore a world of knowledge at your fingertips.</p>
    </div>

    <div class="library-container">
        <div class="controls">
            <input type="text" class="search-bar" placeholder="Search books by title or author...">
            <div class="filter-options">
                <select id="sort-by">
                    <option value="title-asc">Title (A-Z)</option>
                    <option value="title-desc">Title (Z-A)</option>
                    <option value="author-asc">Author (A-Z)</option>
                    <option value="author-desc">Author (Z-A)</option>
                    <option value="year-asc">Year (Oldest)</option>
                    <option value="year-desc">Year (Newest)</option>
                </select>
                <div class="genre-filter">
                    <div class="genre-title">Browse by Genre</div>
                    <div class="genre-buttons" id="genreFilter"></div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="all">All Books</button>
                <button class="tab-button" data-tab="available">Available</button>
                <button class="tab-button" data-tab="checked-out">Checked Out</button>
            </div>
            <div class="book-list" id="bookList"></div>
        </div>

        <div class="modal" id="bookModal">
            <div class="modal-content">
                <button class="close-modal" id="closeModal">×</button>
                <div class="modal-details" id="modalDetails"></div>
            </div>
        </div>

        <section class="about">
            <h2>About Our Library</h2>
            <p>Discover a world of knowledge with our state-of-the-art virtual library system. We offer a curated collection of books across various genres, available at your fingertips.</p>
        </section>
    </div>

    <footer>
        <p>© 2023 Virtual Library. All rights reserved.</p>
        <p><a href="#">Contact Us</a> | <a href="#">Terms of Service</a> | <a href="#">Privacy Policy</a></p>
    </footer>

    <script>
        // Sample book data
        const books = [
            { id: 1, title: "The Great Gatsby", author: "F. Scott Fitzgerald", genre: "fiction", year: 1925, description: "A tale of wealth, love, and the American Dream.", available: true },
            { id: 2, title: "1984", author: "George Orwell", genre: "sci-fi", year: 1949, description: "A dystopian novel about surveillance and control.", available: false },
            { id: 3, title: "The Hound of the Baskervilles", author: "Arthur Conan Doyle", genre: "mystery", year: 1902, description: "A Sherlock Holmes mystery adventure.", available: true },
            { id: 4, title: "Sapiens", author: "Yuval Noah Harari", genre: "non-fiction", year: 2011, description: "A brief history of humankind.", available: false }
        ];

        const genres = ['all', 'fiction', 'non-fiction', 'mystery', 'sci-fi'];
        const bookGenres = genres.filter(g => g !== 'all');
        let requests = []; // Array to store pending issue requests

        // DOM elements
        const bookList = document.getElementById('bookList');
        const searchBar = document.querySelector('.search-bar');
        const sortSelect = document.getElementById('sort-by');
        const genreFilter = document.getElementById('genreFilter');
        const modal = document.getElementById('bookModal');
        const modalDetails = document.getElementById('modalDetails');
        const closeModal = document.getElementById('closeModal');
        const tabButtons = document.querySelectorAll('.tab-button');
        const panelToggle = document.getElementById('panelToggle');
        const userPanel = document.getElementById('userPanel');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const issueBookBtn = document.getElementById('issueBook');
        const toggleAdmin = document.getElementById('toggleAdmin');
        const addBookBtn = document.getElementById('addBook');
        const viewRequestsBtn = document.getElementById('viewRequests');

        // State variables
        let currentTab = 'all';
        let currentGenre = 'all';
        let isLoggedIn = false;
        let isAdmin = false;
        let user = null;

        // Mock user data
        const mockUser = { name: "John Doe", email: "john@example.com" };

        // Render genre buttons
        function renderGenreButtons() {
            genreFilter.innerHTML = ''; // Clear existing buttons
            genres.forEach(genre => {
                const btn = document.createElement('button');
                btn.className = `genre-btn ${genre === currentGenre ? 'active' : ''}`;
                btn.textContent = genre.charAt(0).toUpperCase() + genre.slice(1);
                btn.dataset.genre = genre;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.genre-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentGenre = genre;
                    updateBookList();
                });
                genreFilter.appendChild(btn);
            });
        }

        // Render books
        function renderBooks(bookArray) {
            bookList.innerHTML = '';
            bookArray.forEach(book => {
                const bookCard = document.createElement('div');
                bookCard.className = 'book-card';
                bookCard.innerHTML = `
                    <div class="book-title">${book.title}</div>
                    <div class="book-author">${book.author}</div>
                    <div class="book-status ${book.available ? 'available' : 'checked-out'}">
                        ${book.available ? 'Available' : 'Checked Out'}
                    </div>
                    ${isAdmin ? `<button class="toggle-status" data-id="${book.id}">Toggle Status</button>` : ''}
                `;
                bookCard.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('toggle-status')) openModal('view', book);
                });
                if (isAdmin) {
                    const toggleBtn = bookCard.querySelector('.toggle-status');
                    toggleBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent opening the modal
                        toggleBookStatus(book.id);
                    });
                }
                bookList.appendChild(bookCard);
            });
        }

        // Handle issue request form submission
        function handleIssueFormSubmission(form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const bookId = parseInt(formData.get('book'));
                const selectedBook = books.find(book => book.id === bookId);
                
                if (selectedBook && selectedBook.available) {
                    const request = {
                        bookId: bookId,
                        bookTitle: selectedBook.title,
                        user: formData.get('user'),
                        issueDate: formData.get('issueDate'),
                        dueDate: formData.get('dueDate')
                    };
                    requests.push(request);
                    modal.style.display = 'none';
                    alert('Request submitted! Waiting for admin approval.');
                } else {
                    alert('This book is no longer available.');
                }
            });
        }

        // Handle add book form submission
        function handleAddBookFormSubmission(form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const newBook = {
                    id: books.length > 0 ? Math.max(...books.map(b => b.id)) + 1 : 1,
                    title: formData.get('title'),
                    author: formData.get('author'),
                    genre: formData.get('genre'),
                    year: parseInt(formData.get('year')),
                    description: formData.get('description'),
                    available: formData.get('available') === 'on'
                };
                books.push(newBook);
                modal.style.display = 'none';
                alert(`Book "${newBook.title}" has been added successfully!`);
                updateBookList();
            });
        }

        // Open modal for viewing, issuing, adding books, or viewing requests
        function openModal(mode, book = null) {
            modalDetails.innerHTML = ''; // Clear previous content
            if (mode === 'view' && book) {
                modalDetails.innerHTML = `
                    <h2>${book.title}</h2>
                    <p><strong>Author:</strong> ${book.author}</p>
                    <p><strong>Genre:</strong> ${book.genre}</p>
                    <p><strong>Year:</strong> ${book.year}</p>
                    <p><strong>Status:</strong> <span class="book-status ${book.available ? 'available' : 'checked-out'}">${book.available ? 'Available' : 'Checked Out'}</span></p>
                    <p>${book.description}</p>
                    ${isLoggedIn && book.available ? `<button id="issueRequestBtn">Issue Request</button>` : ''}
                `;
                if (isLoggedIn && book.available) {
                    setTimeout(() => {
                        const issueRequestBtn = document.getElementById('issueRequestBtn');
                        if (issueRequestBtn) {
                            issueRequestBtn.addEventListener('click', () => openModal('issue', book));
                        }
                    }, 0);
                }
            } else if (mode === 'issue') {
                const availableBooks = books.filter(b => b.available);
                if (availableBooks.length === 0) {
                    modalDetails.innerHTML = `<h2>Issue Request</h2><p>No books are currently available.</p>`;
                    return;
                }
                
                const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format
                
                // Calculate default due date (14 days from today)
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + 14);
                const defaultDueDate = dueDate.toISOString().split('T')[0];
                
                modalDetails.innerHTML = `
                    <h2>Issue Request</h2>
                    <form id="issueForm">
                        <label>Book: <select name="book" required>
                            ${availableBooks.map(b => `<option value="${b.id}" ${book && b.id === book.id ? 'selected' : ''}>${b.title}</option>`).join('')}
                        </select></label><br>
                        <label>User Name: <input type="text" name="user" value="${user ? user.name : ''}" required></label><br>
                        <label>Issue Date: <input type="date" name="issueDate" value="${today}" required></label><br>
                        <label>Due Date: <input type="date" name="dueDate" value="${defaultDueDate}" required></label><br>
                        <button type="submit">Submit Request</button>
                        <button type="button" id="cancelIssue">Cancel</button>
                    </form>
                `;
                
                setTimeout(() => {
                    const issueForm = document.getElementById('issueForm');
                    handleIssueFormSubmission(issueForm);
                    
                    const cancelIssue = document.getElementById('cancelIssue');
                    if (cancelIssue) {
                        cancelIssue.addEventListener('click', () => {
                            modal.style.display = 'none';
                        });
                    }
                }, 0);
            } else if (mode === 'add' && isAdmin) {
                modalDetails.innerHTML = `
                    <h2>Add New Book</h2>
                    <form id="addBookForm">
                        <label>Title: <input type="text" name="title" required></label><br>
                        <label>Author: <input type="text" name="author" required></label><br>
                        <label>Genre: <select name="genre" required>
                            ${bookGenres.map(genre => `<option value="${genre}">${genre.charAt(0).toUpperCase() + genre.slice(1)}</option>`).join('')}
                        </select></label><br>
                        <label>Year: <input type="number" name="year" min="1" max="${new Date().getFullYear()}" required></label><br>
                        <label>Description: <textarea name="description" required></textarea></label><br>
                        <label><input type="checkbox" name="available" checked> Available for checkout</label><br><br>
                        <button type="submit">Add Book</button>
                        <button type="button" id="cancelAdd">Cancel</button>
                    </form>
                `;
                
                setTimeout(() => {
                    const addBookForm = document.getElementById('addBookForm');
                    handleAddBookFormSubmission(addBookForm);
                    
                    const cancelAdd = document.getElementById('cancelAdd');
                    if (cancelAdd) {
                        cancelAdd.addEventListener('click', () => {
                            modal.style.display = 'none';
                        });
                    }
                }, 0);
            } else if (mode === 'requests' && isAdmin) {
                if (requests.length === 0) {
                    modalDetails.innerHTML = `
                        <h2>Pending Issue Requests</h2>
                        <p>No pending requests.</p>
                    `;
                } else {
                    modalDetails.innerHTML = `
                        <h2>Pending Issue Requests</h2>
                        <div id="requestsList">
                            ${requests.map((req, index) => {
                                const book = books.find(b => b.id === req.bookId);
                                if (!book) return ''; // Skip if book doesn't exist
                                
                                return `
                                    <div class="request-item">
                                        <p><strong>Book:</strong> ${book.title}</p>
                                        <p><strong>User:</strong> ${req.user}</p>
                                        <p><strong>Issue Date:</strong> ${req.issueDate}</p>
                                        <p><strong>Due Date:</strong> ${req.dueDate}</p>
                                        <button class="approve-request" data-index="${index}">Approve</button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                    
                    setTimeout(() => {
                        document.querySelectorAll('.approve-request').forEach(btn => {
                            btn.addEventListener('click', () => {
                                const index = parseInt(btn.dataset.index);
                                const request = requests[index];
                                const book = books.find(b => b.id === request.bookId);
                                
                                if (book && book.available) {
                                    book.available = false;
                                    requests.splice(index, 1);
                                    alert(`Request approved! "${book.title}" has been issued to ${request.user}.`);
                                    openModal('requests'); // Refresh requests modal
                                    updateBookList();
                                } else {
                                    alert('This book is no longer available.');
                                    requests.splice(index, 1);
                                    openModal('requests'); // Refresh requests modal
                                }
                            });
                        });
                    }, 0);
                }
            }
            modal.style.display = 'block';
        }

        // Update book list based on filters and sorting
        function updateBookList() {
            let filteredBooks = [...books];

            if (currentTab === 'available') filteredBooks = filteredBooks.filter(book => book.available);
            if (currentTab === 'checked-out') filteredBooks = filteredBooks.filter(book => !book.available);

            const searchTerm = searchBar.value.toLowerCase();
            if (searchTerm) {
                filteredBooks = filteredBooks.filter(book =>
                    book.title.toLowerCase().includes(searchTerm) ||
                    book.author.toLowerCase().includes(searchTerm)
                );
            }

            if (currentGenre !== 'all') {
                filteredBooks = filteredBooks.filter(book => book.genre === currentGenre);
            }

            const sortValue = sortSelect.value;
            filteredBooks.sort((a, b) => {
                if (sortValue === 'title-asc') return a.title.localeCompare(b.title);
                if (sortValue === 'title-desc') return b.title.localeCompare(a.title);
                if (sortValue === 'author-asc') return a.author.localeCompare(b.author);
                if (sortValue === 'author-desc') return b.author.localeCompare(a.author);
                if (sortValue === 'year-asc') return a.year - b.year;
                if (sortValue === 'year-desc') return b.year - a.year;
                return 0;
            });

            renderBooks(filteredBooks);
        }

        // Toggle book status (Admin only)
        function toggleBookStatus(id) {
            const book = books.find(b => b.id === id);
            if (book) {
                // If we're making the book unavailable, check if there are pending requests
                if (book.available) {
                    const pendingRequests = requests.filter(req => req.bookId === id);
                    if (pendingRequests.length > 0) {
                        if (confirm(`There are ${pendingRequests.length} pending requests for this book. Do you want to mark it as checked out anyway?`)) {
                            book.available = false;
                            updateBookList();
                        }
                    } else {
                        book.available = false;
                        updateBookList();
                    }
                } else {
                    book.available = true;
                    updateBookList();
                }
            }
        }

        // Update user panel visibility
        function updateUserPanel() {
            if (isLoggedIn) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                issueBookBtn.style.display = 'block';
                toggleAdmin.style.display = 'block';
                addBookBtn.style.display = isAdmin ? 'block' : 'none';
                viewRequestsBtn.style.display = isAdmin ? 'block' : 'none';
            } else {
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                issueBookBtn.style.display = 'none';
                toggleAdmin.style.display = 'none';
                addBookBtn.style.display = 'none';
                viewRequestsBtn.style.display = 'none';
            }
        }

        // Event listeners
        searchBar.addEventListener('input', updateBookList);
        sortSelect.addEventListener('change', updateBookList);

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentTab = button.dataset.tab;
                updateBookList();
            });
        });

        closeModal.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // Close modal when clicking outside content
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        panelToggle.addEventListener('click', () => {
            userPanel.classList.toggle('active');
        });

        // Hide user panel when clicking elsewhere
        document.addEventListener('click', (e) => {
            if (!panelToggle.contains(e.target) && !userPanel.contains(e.target) && userPanel.classList.contains('active')) {
                userPanel.classList.remove('active');
            }
        });

        loginBtn.addEventListener('click', () => {
            isLoggedIn = true;
            user = mockUser;
            updateUserPanel();
            alert(`Logged in as ${mockUser.name}`);
        });

        logoutBtn.addEventListener('click', () => {
            isLoggedIn = false;
            isAdmin = false;
            user = null;
            updateUserPanel();
            updateBookList();
            alert('Logged out successfully');
        });

        issueBookBtn.addEventListener('click', () => {
            if (isLoggedIn) {
                openModal('issue');
            } else {
                alert('Please log in first');
            }
        });

        toggleAdmin.addEventListener('click', () => {
            if (isLoggedIn) {
                isAdmin = !isAdmin;
                updateUserPanel();
                updateBookList();
                alert(isAdmin ? 'Admin mode activated' : 'User mode activated');
            }
        });

        addBookBtn.addEventListener('click', () => {
            if (isAdmin) {
                openModal('add');
            }
        });

        viewRequestsBtn.addEventListener('click', () => {
            if (isAdmin) {
                openModal('requests');
            }
        });

        // Set default date values for all date inputs
        function setDefaultDates() {
            const dateInputs = document.querySelectorAll('input[type="date"]');
            const today = new Date().toISOString().split('T')[0];
            
            dateInputs.forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
        }

        // Initial render
        renderGenreButtons();
        updateUserPanel();
        updateBookList();
    </script>
</body>
</html>